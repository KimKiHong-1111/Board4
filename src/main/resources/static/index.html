<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>To-Do List (Vanilla JS)</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0f172a; color:#e2e8f0; margin:0; }
    .app { max-width: 720px; margin: 64px auto; padding: 24px; background:#111827; border:1px solid #1f2937; border-radius:16px; }
    h1 { margin:0 0 16px; font-size: 24px; }
    .row { display:flex; gap:8px; margin-bottom:12px; }
    input[type="text"] {
      flex:1; padding:12px 14px; background:#0b1220; border:1px solid #263143; color:#e2e8f0; border-radius:10px; outline:none;
    }
    button {
      padding:12px 14px; border:1px solid #263143; background:#0b1220; color:#e2e8f0; border-radius:10px; cursor:pointer;
    }
    button:hover { filter: brightness(1.2); }
    .filters { display:flex; gap:8px; margin:8px 0 16px; }
    .filters button.active { border-color:#64748b; }
    ul { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
    li { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border:1px solid #263143; background:#0b1220; border-radius:10px; }
    .title { flex:1; word-break:break-all; }
    .done .title { text-decoration: line-through; color:#94a3b8; }
    .small { font-size:12px; color:#94a3b8; }
    .right { display:flex; align-items:center; gap:6px; }
  </style>
</head>
<body>
<div class="app">
  <h1>To-Do List <span class="small">(로컬 저장)</span></h1>

  <div class="row">
    <input id="todo-input" placeholder="할 일을 입력하세요… (Enter)" />
    <button id="add-btn">추가</button>
    <button id="clear-btn" title="모든 항목 삭제">전체삭제</button>
  </div>

  <div class="filters">
    <button data-filter="all" class="active">전체</button>
    <button data-filter="active">진행중</button>
    <button data-filter="done">완료</button>
  </div>

  <ul id="todo-list"></ul>

  <p class="small" id="count"></p>
</div>

<script>
  // ---- 상태 & 스토리지 ----
  const STORAGE_KEY = 'todos.v1';
  /** @type {{id:string, title:string, done:boolean, created:number}[]} */
  let todos = [];

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
    updateCount();
  }
  function load() {
    const raw = localStorage.getItem(STORAGE_KEY);
    todos = raw ? JSON.parse(raw) : [];
    updateCount();
  }

  // ---- DOM 캐시 ----
  const $list = document.getElementById('todo-list');
  const $input = document.getElementById('todo-input');
  const $add = document.getElementById('add-btn');
  const $clear = document.getElementById('clear-btn');
  const $filters = document.querySelectorAll('.filters button');
  const $count = document.getElementById('count');
  let currentFilter = 'all';

  // ---- 유틸 ----
  const uid = () => Math.random().toString(36).slice(2, 10);

  // ---- 렌더 ----
  function render() {
    $list.innerHTML = '';
    let list = todos;
    if (currentFilter === 'active') list = todos.filter(t => !t.done);
    if (currentFilter === 'done')   list = todos.filter(t =>  t.done);

    for (const t of list) {
      const li = document.createElement('li');
      if (t.done) li.classList.add('done');

      const left = document.createElement('div');
      left.className = 'title';
      left.textContent = t.title;

      const right = document.createElement('div');
      right.className = 'right';

      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = t.done ? '되돌리기' : '완료';
      toggleBtn.addEventListener('click', () => {
        t.done = !t.done;
        save(); render();
      });

      const delBtn = document.createElement('button');
      delBtn.textContent = '삭제';
      delBtn.addEventListener('click', () => {
        todos = todos.filter(x => x.id !== t.id);
        save(); render();
      });

      right.append(toggleBtn, delBtn);
      li.append(left, right);
      $list.append(li);
    }
  }

  function updateCount() {
    const total = todos.length;
    const done = todos.filter(t => t.done).length;
    $count.textContent = `총 ${total}개 · 완료 ${done}개 · 진행중 ${total - done}개`;
  }

  // ---- 이벤트 ----
  function addTodo() {
    const title = $input.value.trim();
    if (!title) return;
    todos.unshift({ id: uid(), title, done: false, created: Date.now() });
    $input.value = '';
    save(); render();
  }

  $add.addEventListener('click', addTodo);
  $input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') addTodo();
  });

  $clear.addEventListener('click', () => {
    if (todos.length === 0) return;
    if (!confirm('정말 전체 삭제할까요?')) return;
    todos = [];
    save(); render();
  });

  $filters.forEach(btn => {
    btn.addEventListener('click', () => {
      $filters.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.dataset.filter;
      render();
    });
  });

  // 초기화
  load();
  render();
</script>
</body>
</html>
